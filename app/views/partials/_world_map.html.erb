<% dev = locals[:device] %>
<div id="map-card" class="cl-card flex-column-centred full-width mb-4">
  <h2 class="mb-4">Location</h2>
  <div id="map-wrapper" class="full-width"></div>
</div>

<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/map.js"></script>
<script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
<script>
  const root = am5.Root.new("map-wrapper");
  const chart = root.container.children.push(
    am5map.MapChart.new(root, {
      panX: "rotateX",
      projection: am5map.geoEqualEarth()
    })
  );
  const polygonSeries = chart.series.push(
    am5map.MapPolygonSeries.new(root, {
      geoJSON: am5geodata_worldLow,
      fill: am5.color(0x2794d8),
    })
  );
  const pointSeries = chart.series.push(
    am5map.MapPointSeries.new(root, {
    })
  );
  pointSeries.bullets.push(function() {
<!--    return am5.Bullet.new(root, {-->
<!--      sprite: am5.Circle.new(root, {-->
<!--        radius: 5,-->
<!--        fill: am5.color(0xffba00),-->
<!--        tooltipText: "<%#= dev.country.common_name %>"-->
<!--      })-->
<!--    });-->
    var container = am5.Container.new(root, {});
    var color = am5.color(0xffba00);
    var radius = 20;
    var circle = container.children.push(am5.Circle.new(root, {
      radius: radius,
      fill: color,
      dy: -radius * 2
    }))
    var pole = container.children.push(am5.Line.new(root, {
      stroke: color,
      height: -20,
      strokeGradient: am5.LinearGradient.new(root, {
        stops:[
          { opacity: 1 },
          { opacity: 1 },
          { opacity: 0 }
        ]
      })
    }));
    var label = container.children.push(am5.Label.new(root, {
      text: "1",
      fill: am5.color(0xffffff),
      fontWeight: "400",
      centerX: am5.p50,
      centerY: am5.p50,
      dy: -radius * 2
    }))

    return am5.Bullet.new(root, {
      sprite: container
    });
  });
  pointSeries.data.setAll([{
    geometry: {
      type: "Point",
      coordinates: [<%= dev.country.longitude %>, <%= dev.country.latitude %>]
    }
  }]);
</script>
