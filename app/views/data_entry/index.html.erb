<h1 class="text-center mb-5">Enter your server data</h1>
<div class="mb-4 text-center">
  <p>Is your server connected to the internet?</p>
  <input type="radio" id="radio-yes" name="internet" value="yes" checked="checked">
  <label for="yes">Yes</label>
  <input type="radio" id="radio-no" name="internet" value="no">
  <label for="no">No</label>
</div>

<%= render 'step_card', locals: {
  number: 1,
  title: 'Make an account (optional)',
  show_card: { online: true, offline: true },
} do %>
  <% content_for :buttons, :flush => true do %>
    <%= link_to "Sign up", new_registration_path(:user) %>
  <% end %>
  <p>
    Make an account to claim your servers on the leaderboard and get
    access to tools for tracking your server emission stats more easily.
  </p>
<% end %>
<%= render 'step_card', locals: {
  number: 2.1,
  title: 'Run the Carbon Client on your server',
  hide_actions: true,
  show_card: { online: true, offline: false },
} do %>
  <% content_for :buttons, :flush => true do %>
    <div></div>
  <% end %>
  <p>
    To collect data on your server specifications and enter onto the leaderboard,
    run the following command on your server:
  </p>
  <p class="code-wrapper">
    <code class="code-block">
      curl -s -L https://github.com/openflighthpc/carbon-leaderboard/raw/main/carbon-client/carbon | COMMAND='send'
      ACCEPT_DEFAULTS='true' /bin/bash
    </code>
  </p>
  <p>
    For more options, such as associating your servers with your user account,
    see the advanced usage information below.
  </p>
<% end %>

<%= render 'step_card', locals: {
  number: 2.2,
  title: 'Download the Carbon Client',
  show_card: { online: false, offline: true },
} do %>
  <% content_for :buttons, :flush => true do %>
    <%= link_to "Download", action: :download_carbon %>
  <% end %>
  <p>
    The Carbon Client is a BASH script which collects the required data for
    adding entries to the Carbon Leaderboard.
  </p>
<% end %>
<%= render 'step_card', locals: {
  number: 3,
  title: 'Run the Carbon Client on your server',
  hide_actions: true,
  show_card: { online: false, offline: true },
} do %>
  <% content_for :buttons, :flush => true do %>
    <div></div>
  <% end %>
  <p>
    To collect data on your server emissions and enter onto the leaderboard,
    save the Carbon Client on your server and run the following command:
  </p>
  <p class="text-center mb-4">
    <code class="code-block">bash carbon send</code>
  </p>
  <p>
    This will collect all the data you need to enter your server onto the leaderboard.
    However, you can find information below about more advanced options, such
    as associating your servers with your user account.
  </p>
<% end %>
<%= render 'step_card', locals: {
  number: 4,
  title: 'Upload your data',
  show_card: { online: false, offline: true },
} do %>
  <% content_for :buttons, :flush => true do %>
    <%= form_with url: "/data-entry/upload", multipart: true do |form| %>
      <%= file_field_tag :device %>
      <%= submit_tag "Upload", class: "button" %>
      <% if params[:upload_status] %>
        <% if params[:upload_status].empty? %>
          <span>Upload successful</span>
        <% else %>
          <span>Upload failed: <%= params[:upload_status] %></span>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
  <p>
    Find your payload file at <code>carbon-log/payload-${UUID}.json</code> and upload it below.
  </p>
<% end %>
<%= render 'step_card', locals: {
  number: 5,
  title: 'See how your server does on the leaderboard!',
  show_card: { online: true, offline: true },
} do %>
  <% content_for :buttons, :flush => true do %>
    <%= link_to "View leaderboard", leaderboard_path %>
  <% end %>
<% end %>

<hr class="wide-card">

<div class="card wide-card advanced-card">
      <h3>Advanced usage options</h3>

      <div class="advanced-instruction-wrapper">
        <button class="button"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#accountInstructions"
                aria-expanded="false"
                aria-controls="accountInstructions"
        >
          <span class="big-blue-plus">+</span>
          <span class="big-text">Associating a device with your user account</span>
        </button>
        <div class="collapse" id="accountInstructions">
          <br>
          <p>
            When collecting system information in the leaderboard it may be desired to
            optionally "claim" the device that is being sent. To do so, a user account
            will need to be created in the leaderboard and the <code>JWT_TOKEN</code>
            for the user will need to be set as the environment variable <code>AUTH_TOKEN</code>.
          </p>
        </div>
      </div>

      <div class="step-instructions advanced-instruction-wrapper">
        <button class="button" 
                type="button" 
                data-bs-toggle="collapse" 
                data-bs-target="#locationInstructions" 
                aria-expanded="false" 
                aria-controls="locationInstructions"
        >
          <span class="big-blue-plus">+</span>
          <span class="big-text">Specifying Location</span>
        </button>
        <div class="collapse" id="locationInstructions">
          <br>
          <p>
            If the connection to the Internet goes via a VPN or proxy then the location
            determined by the script may be incorrect. To override the automated location
            identified, ensure that the environment variable <code>LOCATION</code> is set
            to a valid ISO 3166-1 alpha-3 code.
          </p>
        </div>
      </div>

    </div>
  </div>
</div>

<script type="text/javascript" src="/assets/data_entry/index.js"></script>
