<h1 class="mb-5"><%= @device.display_name %></h1>

<style>
table, th, td {
  border:1px solid black;
}
td {
  text-align: center;
}
</style>

<div class="cl-card flex-column-centred mb-4">
  <div class="device-type-wrapper">
    <%= image_tag 'logo.svg' %>
    <div>
      <% if @device.cloud_provider %>
        <h4><%= @device.cloud_provider %></h4>
        <span><%= @device.instance_type %></span>
      <% else %>
        <h4>On Premise</h4>
      <% end %>
    </div>
  </div>
  <div class="device-specs-wrapper">
    <div>
      <strong>CPU cores</strong>
      <span><%= @device.cpus * @device.cores_per_cpu %></span>
    </div>
    <div>
      <strong>GPUs</strong>
      <span><%= @device.gpus.length %></span>
    </div>
    <div>
      <strong>RAM</strong>
      <span><%= @device.ram %>GB</span>
    </div>
    <div>
      <strong>Mem</strong>
      <span><%= @device.total_memory %>GB</span>
    </div>
  </div>
</div>


<table style="width:100%" align="right">
  <tr>
    <th>Owner</th>
    <th>CPU name</th>
    <th>CPUs</th>
    <th>Cores Per CPU</th>
    <th>RAM Units</th>
    <th>RAM Capacity Per Unit</th>
    <th>Disks</th>
    <th>GPUs</th>
    <th>Carbon Usage (min)</th>
    <th>Carbon Usage (half)</th>
    <th>Carbon Usage (max)</th>
    <th>Platform</th>
    <th>Cloud Provider ID</th>
    <th>Instance Type</th>
    <th>Location</th>
    <th>Tags</th>
  </tr>
  <tr>
    <td><%= username(@device.user_id) %></td>
    <td><%= @device.cpu_name %></td>
    <td><%= @device.cpus %></td>
    <td><%= @device.cores_per_cpu %></td>
    <td><%= @device.ram_units %></td>
    <td><%= @device.ram_capacity_per_unit %></td>
    <td>
      <%=
      disk_string = ""
      @device.disks.each do |disk|
        disk_string << "#{disk['units']} x #{disk['capacity']}GB #{disk['type'].upcase}\n"
      end
      simple_format(disk_string)
      %>
    </td>
    <td><%= @device.gpus %></td>
    <td><%= @device.min %></td>
    <td><%= @device.half %></td>
    <td><%= @device.max %></td>
    <td><%= @device.platform %></td>
    <td><%= @device.cloud_provider %></td>
    <td><%= @device.instance_type %></td>
    <td><%= @device.location %></td>
    <td><%= @device.tags.join(", ") %></td>
  </tr>
</table>

<h3 class="my-5">Live emissions</h3>
<%= line_chart @device.reports.map { |report| [report.created_at.to_time, report.current] } %>
